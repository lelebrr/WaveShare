[platformio]
default_envs = wavepwn_final

[env:wavepwn_final]
platform = espressif32@6.9.0
board = esp32-s3-devkitc-1
framework = arduino

; ========== CONFIGURAÇÃO DO HARDWARE WAVESHARE ESP32-S3-Touch-AMOLED-1.8 ==========
board_build.mcu = esp32s3
board_build.variant = esp32s3
board_build.psram_type = opi
board_build.flash_size = 16MB
upload_speed = 921600

; === SCRIPTS (Tip 53 & 30) ===
extra_scripts = 
    pre:scripts/generate_build_info.py

; === DEPENDÊNCIAS ===
lib_ldf_mode = deep
lib_compat_mode = soft

lib_deps = 
    bblanchon/ArduinoJson@^6.21.5
    arduino-libraries/NTPClient@^3.2.1
    mathieucarbou/AsyncTCP@^3.3.2
    mathieucarbou/ESPAsyncWebServer@^3.6.0
    tanakamasayuki/TensorFlowLite_ESP32
    bitbank2/PNGdec@^1.0.1
    lewisxhe/XPowersLib@^0.2.0
    crankyoldgit/IRremoteESP8266@^2.8.6

; === FLAGS (Tips 16, 47, 5, 21, 36, 40, 61, 72) ===
build_unflags = -Os -O2
build_flags = 
    -std=gnu++2a ; Tip 5 (C++20)
    -O3 ; Tip 16: Max optimization
    ; -flto ; Removed - incompatible with ESP32-S3 toolchain
    -funroll-loops ; Tip 16: Fast loops
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
     ; -march=xtensa removed - invalid for s3 compiler
    -mfix-esp32-psram-cache-issue ; Tip 17 / User Step 4
    -D LV_CONF_INCLUDE_SIMPLE
    -D LV_LVGL_H_INCLUDE_SIMPLE
    -D BOARD_HAS_PSRAM
    -D ARDUINO_USB_MODE=1
    -D ARDUINO_USB_CDC_ON_BOOT=1
    -D CONFIG_SPIRAM_USE_MALLOC ; Tip 40
    -D CONFIG_ESP32S3_SPIRAM_SUPPORT=1 ; Tip 40
    -D WAVESHARE_AMOLED_1_8
    -D RELEASE_BUILD
    -D CORE_DEBUG_LEVEL=0 ; Tip 36: No logs
    -D CONFIG_COMPILER_OPTIMIZATION_SIZE=1 ; Tip 47
    -D ARDUINO_RUNNING_CORE=1       ; User Step 4
    -D ARDUINO_EVENT_RUNNING_CORE=1 ; User Step 4

    -I src
    -I lib
    -I include
    -Wno-deprecated-declarations

; Tip 61: Flash Optimizations
board_build.f_flash = 80000000L
board_build.flash_mode = qio
board_build.partitions = partitions_custom.csv
